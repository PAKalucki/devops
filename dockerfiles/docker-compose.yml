version: '3'

services:
  samba:
    image: dperson/samba:rpi
    ports:
      - "139:139/tcp"
      - "445:445/tcp"
    volumes:
      - /mnt/natec:/mount
    restart: unless-stopped
    command: "-s public;/mount/public;yes;no"

  nordvpn:
    image: pakalucki/nordvpn:latest
    ports:
      - "1194:1194/udp"
    environment:
      username: ${NORDVPN_USER}
      password: ${NORDVPN_PASSWORD}
      protocol: udp
    devices:
      - "/dev/net/tun"
    cap_add:
      - NET_ADMIN
    restart: unless-stopped
    command: random

  proxy:
    image: pakalucki/proxy:latest
    ports:
      - "8443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    links:
      - "nordvpn:transmission"
    restart: unless-stopped
    depends_on:
      - "transmission"

  transmission:
    image: linuxserver/transmission:arm32v7-latest
    volumes:
      - /config
      - /watch
      - /mnt/natec/public/torrent/downloads:/downloads
    network_mode: "service:nordvpn"
    environment:
      TZ: "Europe/Warsaw"
      USER: ${TRANSMISSION_USER}
      PASS: ${TRANSMISSION_PASS}
    restart: unless-stopped
    depends_on:
      - "nordvpn"